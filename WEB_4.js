var Tx = require('ethereumjs-tx').Transaction;
var Web3 = require("web3");

const rpcURL = "https://ropsten.infura.io/v3/d2e382f4eddc45c19db782cce7a59b2a";
const web3 = new Web3(rpcURL);
const account = "0x59A5BAe94a3BD41cc93C0374956698FF95FdaF01";
const privatekey = "cdac82c4d138d3b976d9b381b5bbe8ec96a0015a6154c4b9e5754dd08f25be9b";
const byteCode = "60806040523480156200001157600080fd5b506040518060400160405280601081526020017f414641512d414853414e2d544f4b454e00000000000000000000000000000000815250600190805190602001906200005f92919062000213565b506040518060400160405280600381526020017f414149000000000000000000000000000000000000000000000000000000000081525060029080519060200190620000ad92919062000213565b506012600381905550336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600354600a6200010791906200034c565b620f424062000117919062000489565b600481905550600454600560008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef600454604051620002059190620002d4565b60405180910390a362000595565b8280546200022190620004f4565b90600052602060002090601f01602090048101928262000245576000855562000291565b82601f106200026057805160ff191683800117855562000291565b8280016001018555821562000291579182015b828111156200029057825182559160200191906001019062000273565b5b509050620002a09190620002a4565b5090565b5b80821115620002bf576000816000905550600101620002a5565b5090565b620002ce81620004ea565b82525050565b6000602082019050620002eb6000830184620002c3565b92915050565b6000808291508390505b600185111562000343578086048111156200031b576200031a6200052a565b5b60018516156200032b5780820291505b80810290506200033b8562000588565b9450620002fb565b94509492505050565b60006200035982620004ea565b91506200036683620004ea565b9250620003957fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff84846200039d565b905092915050565b600082620003af576001905062000482565b81620003bf576000905062000482565b8160018114620003d85760028114620003e35762000419565b600191505062000482565b60ff841115620003f857620003f76200052a565b5b8360020a9150848211156200041257620004116200052a565b5b5062000482565b5060208310610133831016604e8410600b8410161715620004535782820a9050838111156200044d576200044c6200052a565b5b62000482565b620004628484846001620002f1565b925090508184048111156200047c576200047b6200052a565b5b81810290505b9392505050565b60006200049682620004ea565b9150620004a383620004ea565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615620004df57620004de6200052a565b5b828202905092915050565b6000819050919050565b600060028204905060018216806200050d57607f821691505b6020821081141562000524576200052362000559565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60008160011c9050919050565b61136080620005a56000396000f3fe608060405234801561001057600080fd5b506004361061009e5760003560e01c806370a082311161006657806370a082311461015d5780638da5cb5b1461018d57806395d89b41146101ab578063a9059cbb146101c9578063dd62ed3e146101f95761009e565b806306fdde03146100a3578063095ea7b3146100c157806318160ddd146100f157806323b872dd1461010f578063313ce5671461013f575b600080fd5b6100ab610229565b6040516100b89190610ef6565b60405180910390f35b6100db60048036038101906100d69190610d48565b6102b7565b6040516100e89190610edb565b60405180910390f35b6100f961048e565b6040516101069190610fd8565b60405180910390f35b61012960048036038101906101249190610cf5565b610498565b6040516101369190610edb565b60405180910390f35b6101476107e3565b6040516101549190610fd8565b60405180910390f35b61017760048036038101906101729190610c88565b6107e9565b6040516101849190610fd8565b60405180910390f35b610195610832565b6040516101a29190610ec0565b60405180910390f35b6101b3610856565b6040516101c09190610ef6565b60405180910390f35b6101e360048036038101906101de9190610d48565b6108e4565b6040516101f09190610edb565b60405180910390f35b610213600480360381019061020e9190610cb5565b610bd7565b6040516102209190610fd8565b60405180910390f35b6001805461023690611114565b80601f016020809104026020016040519081016040528092919081815260200182805461026290611114565b80156102af5780601f10610284576101008083540402835291602001916102af565b820191906000526020600020905b81548152906001019060200180831161029257829003601f168201915b505050505081565b600080339050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141561032d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032490610f78565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16141561039d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161039490610fb8565b60405180910390fd5b82600660008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258560405161047b9190610fd8565b60405180910390a3600191505092915050565b6000600454905090565b6000803390506000600660008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050838111610561576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161055890610f38565b60405180910390fd5b838161056d9190611065565b905083600560008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546105ba9190611065565b600560008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555083600560008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610648919061100f565b600560008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508473ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef866040516106e89190610fd8565b60405180910390a380600660008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168673ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925866040516107ce9190610fd8565b60405180910390a36001925050509392505050565b60035481565b6000600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6002805461086390611114565b80601f016020809104026020016040519081016040528092919081815260200182805461088f90611114565b80156108dc5780601f106108b1576101008083540402835291602001916108dc565b820191906000526020600020905b8154815290600101906020018083116108bf57829003601f168201915b505050505081565b600080339050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141561095a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161095190610f18565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1614156109ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109c190610f58565b60405180910390fd5b82600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205411610a4b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a4290610f98565b60405180910390fd5b82600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610a969190611065565b600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555082600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610b24919061100f565b600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef85604051610bc49190610fd8565b60405180910390a3600191505092915050565b6000600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600081359050610c6d816112fc565b92915050565b600081359050610c8281611313565b92915050565b600060208284031215610c9e57610c9d6111a4565b5b6000610cac84828501610c5e565b91505092915050565b60008060408385031215610ccc57610ccb6111a4565b5b6000610cda85828601610c5e565b9250506020610ceb85828601610c5e565b9150509250929050565b600080600060608486031215610d0e57610d0d6111a4565b5b6000610d1c86828701610c5e565b9350506020610d2d86828701610c5e565b9250506040610d3e86828701610c73565b9150509250925092565b60008060408385031215610d5f57610d5e6111a4565b5b6000610d6d85828601610c5e565b9250506020610d7e85828601610c73565b9150509250929050565b610d9181611099565b82525050565b610da0816110ab565b82525050565b6000610db182610ff3565b610dbb8185610ffe565b9350610dcb8185602086016110e1565b610dd4816111a9565b840191505092915050565b6000610dec602a83610ffe565b9150610df7826111ba565b604082019050919050565b6000610e0f601b83610ffe565b9150610e1a82611209565b602082019050919050565b6000610e32602783610ffe565b9150610e3d82611232565b604082019050919050565b6000610e55601d83610ffe565b9150610e6082611281565b602082019050919050565b6000610e78601483610ffe565b9150610e83826112aa565b602082019050919050565b6000610e9b601b83610ffe565b9150610ea6826112d3565b602082019050919050565b610eba816110d7565b82525050565b6000602082019050610ed56000830184610d88565b92915050565b6000602082019050610ef06000830184610d97565b92915050565b60006020820190508181036000830152610f108184610da6565b905092915050565b60006020820190508181036000830152610f3181610ddf565b9050919050565b60006020820190508181036000830152610f5181610e02565b9050919050565b60006020820190508181036000830152610f7181610e25565b9050919050565b60006020820190508181036000830152610f9181610e48565b9050919050565b60006020820190508181036000830152610fb181610e6b565b9050919050565b60006020820190508181036000830152610fd181610e8e565b9050919050565b6000602082019050610fed6000830184610eb1565b92915050565b600081519050919050565b600082825260208201905092915050565b600061101a826110d7565b9150611025836110d7565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561105a57611059611146565b5b828201905092915050565b6000611070826110d7565b915061107b836110d7565b92508282101561108e5761108d611146565b5b828203905092915050565b60006110a4826110b7565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b60005b838110156110ff5780820151818401526020810190506110e4565b8381111561110e576000848401525b50505050565b6000600282049050600182168061112c57607f821691505b602082108114156111405761113f611175565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600080fd5b6000601f19601f8301169050919050565b7f20594f5520415245205452414e53464552494e472046524f4d20544845205a4560008201527f524f204144445245535300000000000000000000000000000000000000000000602082015250565b7f5452414e5346455220414d4d4f554e5420495320455843454445440000000000600082015250565b7f594f5520415245205452414e53464552494e4720544f20544845205a45524f2060008201527f4144445245535300000000000000000000000000000000000000000000000000602082015250565b7f415050524f56452046524f4d20544845205a45524f2041444452455353000000600082015250565b7f494e53554646494349454e542042414c414e4345000000000000000000000000600082015250565b7f415050524f564520544f20544845205a45524f20414444524553530000000000600082015250565b61130581611099565b811461131057600080fd5b50565b61131c816110d7565b811461132757600080fd5b5056fea26469706673582212204a417d5a497cfde9cdd6bd068be23d2cc13b3ec90c59a559edc4cc30deab99d464736f6c63430008070033";
const byteCodeBuffer = Buffer.from(byteCode, "hex");
const privatekeyBuffer = Buffer.from(privatekey, "hex");

/*
web3.eth.getTransactionCount(account, (error, txCount)=>{
    console.log(txCount);
    if (error){
        console.log("Error", error)
    }
    else{
        const txObj = {
            nonce: web3.utils.toHex(txCount),
            data: byteCodeBuffer,
            gasLimit:  web3.utils.toHex(1000000),
            gasPrice:  web3.utils.toHex(web3.utils.toWei("10","gwei"))
        }
        const tx = new Tx(txObj, { chain: "ropsten", hardfork: "petersburg" });
        tx.sign(privatekeyBuffer);
        const serializedTx = tx.serialize();
        const raw = "0x" + serializedTx.toString('hex');
        web3.eth.sendSignedTransaction(raw, (error, txHash)=>{
            if(error){
                console.log("Transaction error", error)
            }
            else{
                console.log("Transaction hash", txHash)
            }
        }).then(receipt =>{
            console.log("Transaction receipt", receipt);
        })
    }
})
*/
const deployFunction = async () => {
    try {
        const txCount = await web3.eth.getTransactionCount(account);
        const TxObject = {
            nonce: web3.utils.toHex(txCount),
            data: byteCodeBuffer,
            gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gWei')),
            gasLimit: web3.utils.toHex(5000000)
        }

        const tx = new Tx(TxObject, { 'chain':'ropsten' });
        tx.sign(privatekeyBuffer);
        const serializedTX = tx.serialize();
        const raw = '0x' + serializedTX.toString('hex');

        const response = await web3.eth.sendSignedTransaction(raw);
        console.log(response);

    }catch(err) {
        console.log(err);
    }
}
deployFunction()
